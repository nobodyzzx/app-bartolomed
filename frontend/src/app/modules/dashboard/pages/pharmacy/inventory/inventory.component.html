<div class="inventory-container min-h-screen bg-slate-50 p-8">
  <div class="max-w-7xl mx-auto">
    <!-- Header Unificado -->
    <div class="flex items-center justify-between mb-10">
      <div class="flex items-center gap-4">
        <button
          type="button"
          (click)="goBack()"
          class="inline-flex items-center justify-center w-11 h-11 rounded-full bg-blue-50 text-blue-600 hover:bg-blue-100 hover:text-blue-700 shadow-md hover:shadow-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-200 focus-visible:ring-offset-1 transition-all border-0"
          matTooltip="Volver"
          aria-label="Volver"
        >
          <mat-icon class="!text-[20px] leading-none">arrow_back</mat-icon>
        </button>
        <div class="text-left">
          <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-0.5">
            Inventario de Farmacia
          </h1>
          <p class="text-slate-600">Gestión y control de medicamentos e insumos</p>
        </div>
      </div>
      <button
        type="button"
        (click)="addProduct()"
        class="inline-flex items-center gap-2 px-5 py-2.5 rounded-full font-medium bg-blue-50 text-blue-600 hover:bg-blue-100 hover:text-blue-700 shadow-md hover:shadow-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-200 focus-visible:ring-offset-1 transition-all border-0"
        aria-label="Crear nuevo producto"
      >
        <mat-icon class="!text-[20px] leading-none">add</mat-icon>
        Nuevo Producto
      </button>
    </div>

    <!-- Estadísticas -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
      <div
        class="bg-blue-50 p-4 rounded-xl border-l-4 border-blue-500 shadow-md hover:shadow-lg transition-shadow cursor-pointer"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-blue-600 text-sm font-semibold">Total Productos</p>
            <p class="text-3xl font-bold text-blue-900 mt-2">{{ stats.totalProducts }}</p>
            <p class="text-xs text-blue-600/60 mt-1">En inventario</p>
          </div>
          <mat-icon class="text-blue-500 !text-[40px] !w-10 !h-10">inventory_2</mat-icon>
        </div>
      </div>

      <div
        class="bg-orange-50 p-4 rounded-xl border-l-4 border-orange-500 shadow-md hover:shadow-lg transition-shadow cursor-pointer"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-orange-600 text-sm font-semibold">Stock Bajo</p>
            <p class="text-3xl font-bold text-orange-900 mt-2">{{ stats.lowStock }}</p>
            <p class="text-xs text-orange-600/60 mt-1">Requieren reabastecimiento</p>
          </div>
          <mat-icon class="text-orange-500 !text-[40px] !w-10 !h-10">warning</mat-icon>
        </div>
      </div>

      <div
        class="bg-red-50 p-4 rounded-xl border-l-4 border-red-500 shadow-md hover:shadow-lg transition-shadow cursor-pointer"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-red-600 text-sm font-semibold">Por Vencer</p>
            <p class="text-3xl font-bold text-red-900 mt-2">{{ stats.expiring }}</p>
            <p class="text-xs text-red-600/60 mt-1">Próximos a caducar</p>
          </div>
          <mat-icon class="text-red-500 !text-[40px] !w-10 !h-10">schedule</mat-icon>
        </div>
      </div>

      <div
        class="bg-green-50 p-4 rounded-xl border-l-4 border-green-500 shadow-md hover:shadow-lg transition-shadow cursor-pointer"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-green-600 text-sm font-semibold">Valor Total</p>
            <p class="text-3xl font-bold text-green-900 mt-2">
              ${{ stats.totalValue | number: '1.2-2' }}
            </p>
            <p class="text-xs text-green-600/60 mt-1">Valor del inventario</p>
          </div>
          <mat-icon class="text-green-500 !text-[40px] !w-10 !h-10">attach_money</mat-icon>
        </div>
      </div>
    </div>

    <!-- Contenido Principal -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8">
      <!-- Barra de Búsqueda y Filtros -->
      <div class="flex items-center gap-4 mb-6">
        <div class="flex-1 max-w-2xl">
          <div class="relative">
            <input
              type="text"
              [(ngModel)]="searchTerm"
              (input)="applyFilterManual()"
              placeholder="Nombre, marca, categoría..."
              class="w-full h-11 rounded-full bg-blue-50 px-5 pr-12 text-slate-900 placeholder-blue-400/70 shadow-md hover:bg-blue-100 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-200 focus:ring-offset-1 focus:bg-white transition border-0"
            />
            <mat-icon class="absolute right-3 top-2.5 text-blue-400">search</mat-icon>
          </div>
        </div>

        <button
          type="button"
          (click)="applyFilterManual()"
          [disabled]="!searchTerm?.trim()"
          class="inline-flex items-center gap-2 px-5 h-11 rounded-full font-medium bg-blue-50 text-blue-600 hover:bg-blue-100 hover:text-blue-700 shadow-md hover:shadow-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-200 focus-visible:ring-offset-1 transition-all disabled:opacity-60 disabled:cursor-not-allowed border-0"
        >
          <mat-icon class="!text-[18px]">search</mat-icon>
          Buscar
        </button>

        <div class="flex-1"></div>

        <button
          type="button"
          class="inline-flex items-center gap-2 px-5 h-11 rounded-full font-medium bg-slate-50 text-slate-700 hover:bg-slate-100 hover:text-slate-900 shadow-md hover:shadow-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-200 focus-visible:ring-offset-1 transition-all border-0"
        >
          <mat-icon class="!text-[18px]">download</mat-icon>
          Exportar
        </button>
      </div>
    </div>

    <!-- Tabla de Productos -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
      <div class="overflow-x-auto">
        <table mat-table [dataSource]="dataSource" matSort class="w-full bg-transparent">
          <!-- Columna ID -->
          <ng-container matColumnDef="id">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="bg-slate-100 text-slate-800 font-semibold p-4 text-left"
            >
              <div class="flex items-center gap-2">
                <mat-icon class="text-blue-600 !text-[18px]">tag</mat-icon>
                ID
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4 text-blue-700 font-medium">
              {{ product.id }}
            </td>
          </ng-container>

          <!-- Columna Nombre -->
          <ng-container matColumnDef="name">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="bg-slate-100 text-slate-800 font-semibold p-4 text-left"
            >
              <div class="flex items-center gap-2">
                <mat-icon class="text-blue-600 !text-[18px]">medication</mat-icon>
                Producto
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4">
              <div class="flex flex-col">
                <span class="font-medium text-slate-900">{{ product.name }}</span>
                <span class="text-xs text-slate-500">{{ product.category }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Columna Marca -->
          <ng-container matColumnDef="brand">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="bg-slate-100 text-slate-800 font-semibold p-4 text-left"
            >
              <div class="flex items-center gap-2">
                <mat-icon class="text-blue-600 !text-[18px]">business</mat-icon>
                Marca
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4 text-slate-600">
              {{ product.brand }}
            </td>
          </ng-container>

          <!-- Columna Stock -->
          <ng-container matColumnDef="stock">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="bg-slate-100 text-slate-800 font-semibold p-4 text-left"
            >
              <div class="flex items-center gap-2">
                <mat-icon class="text-blue-600 !text-[18px]">inventory_2</mat-icon>
                Stock
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4">
              <span
                class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium"
                [ngClass]="
                  isLowStock(product)
                    ? 'bg-red-100 text-red-800 border border-red-200'
                    : 'bg-green-100 text-green-800 border border-green-200'
                "
              >
                <span
                  class="w-2 h-2 rounded-full"
                  [ngClass]="isLowStock(product) ? 'bg-red-500' : 'bg-green-500'"
                ></span>
                {{ product.stock }} unidades
              </span>
            </td>
          </ng-container>

          <!-- Columna Precio -->
          <ng-container matColumnDef="price">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="bg-slate-100 text-slate-800 font-semibold p-4 text-left"
            >
              <div class="flex items-center gap-2">
                <mat-icon class="text-blue-600 !text-[18px]">attach_money</mat-icon>
                Precio
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4 text-green-700 font-semibold">
              ${{ product.price | number: '1.2-2' }}
            </td>
          </ng-container>

          <!-- Columna Fecha de Vencimiento -->
          <ng-container matColumnDef="expirationDate">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="bg-slate-100 text-slate-800 font-semibold p-4 text-left"
            >
              <div class="flex items-center gap-2">
                <mat-icon class="text-blue-600 !text-[18px]">schedule</mat-icon>
                Vencimiento
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4">
              <span
                class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium"
                [ngClass]="
                  isExpiring(product)
                    ? 'bg-orange-100 text-orange-800 border border-orange-200'
                    : 'bg-slate-100 text-slate-700 border border-slate-200'
                "
              >
                {{ product.expirationDate | date: 'dd/MM/yyyy' }}
              </span>
            </td>
          </ng-container>

          <!-- Columna Ubicación -->
          <ng-container matColumnDef="location">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="bg-slate-100 text-slate-800 font-semibold p-4 text-left"
            >
              <div class="flex items-center gap-2">
                <mat-icon class="text-blue-600 !text-[18px]">place</mat-icon>
                Ubicación
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4 text-slate-600">
              {{ product.location }}
            </td>
          </ng-container>

          <!-- Columna Acciones -->
          <ng-container matColumnDef="actions">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="bg-slate-100 text-slate-800 font-semibold p-4 text-left"
            >
              <div class="flex items-center gap-2">
                <mat-icon class="text-blue-600 !text-[18px]">settings</mat-icon>
                Acciones
              </div>
            </th>
            <td mat-cell *matCellDef="let product" class="p-4">
              <div class="flex gap-2 items-center">
                <button
                  mat-icon-button
                  class="w-9 h-9 text-amber-600 hover:bg-amber-50 rounded-lg transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-1 focus-visible:ring-amber-200"
                  (click)="editProduct(product)"
                  matTooltip="Editar producto"
                  aria-label="Editar producto"
                >
                  <mat-icon class="!text-[20px] leading-none">edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  class="w-9 h-9 text-red-600 hover:bg-red-50 rounded-lg transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-1 focus-visible:ring-red-200"
                  (click)="deleteProduct(product)"
                  matTooltip="Eliminar producto"
                  aria-label="Eliminar producto"
                >
                  <mat-icon class="!text-[20px] leading-none">delete</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns"
            class="border-b-2 border-slate-200"
          ></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            class="border-b border-slate-100 hover:bg-slate-50 transition-colors"
          ></tr>
        </table>
      </div>

      <!-- Paginador -->
      <mat-paginator
        [pageSizeOptions]="[10, 25, 50, 100]"
        showFirstLastButtons
        aria-label="Seleccionar página de productos"
        class="bg-slate-50 border-t border-slate-200"
      ></mat-paginator>
    </div>
  </div>
</div>
