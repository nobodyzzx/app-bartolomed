<div class="patient-form-container min-h-screen bg-gradient-to-br from-green-50 via-slate-50 to-green-100 relative overflow-hidden p-8">
  <!-- Elementos decorativos de fondo -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-0 right-0 w-96 h-96 bg-green-200 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob"></div>
    <div class="absolute top-0 left-0 w-96 h-96 bg-emerald-200 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-2000"></div>
    <div class="absolute bottom-0 left-1/2 w-96 h-96 bg-slate-200 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-4000"></div>
  </div>
  
  <div class="patient-form-content" [ngClass]="{ 'sidebar-collapsed': !isExpanded, 'sidebar-expanded': isExpanded }">
    <!-- Header -->
    <div class="text-center mb-12">
      <h2 class="text-3xl font-bold text-green-900 mb-3">{{ isEditMode ? 'Editar Paciente' : 'Nuevo Paciente' }}</h2>
      <div class="w-20 h-1 bg-green-600 mx-auto rounded-full mb-3"></div>
      <p class="text-green-600">{{ isEditMode ? 'Actualice la información del paciente' : 'Complete el formulario para registrar un nuevo paciente' }}</p>
    </div>

    <form [formGroup]="patientForm" (ngSubmit)="onSubmit()" class="mx-auto w-full max-w-6xl p-8 rounded-2xl shadow-lg bg-white space-y-8">
      
      <!-- Información Personal -->
      <div class="bg-white p-8 rounded-2xl shadow-lg border border-green-100 transition-all duration-300 hover:shadow-xl backdrop-blur-sm backdrop-filter" formGroupName="personalInfo">
        <div class="flex items-center mb-8">
          <div class="bg-gradient-to-r from-green-500 to-green-600 p-3 rounded-xl shadow-md mr-4">
            <mat-icon class="text-white">person</mat-icon>
          </div>
          <div>
            <h3 class="text-xl font-semibold text-green-900">Información Personal</h3>
            <p class="text-green-600 text-sm mt-1">Datos personales del paciente</p>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Nombres</mat-label>
            <input matInput formControlName="firstName" required />
            <mat-icon matSuffix class="text-green-400">person</mat-icon>
            <mat-error *ngIf="patientForm.get('personalInfo.firstName')?.hasError('required')">Los nombres son obligatorios</mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Apellidos</mat-label>
            <input matInput formControlName="lastName" required />
            <mat-icon matSuffix class="text-green-400">person</mat-icon>
            <mat-error *ngIf="patientForm.get('personalInfo.lastName')?.hasError('required')">Los apellidos son obligatorios</mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Email</mat-label>
            <input matInput formControlName="email" type="email" />
            <mat-icon matSuffix class="text-green-400">email</mat-icon>
            <mat-error *ngIf="patientForm.get('personalInfo.email')?.hasError('email')">Formato de email inválido</mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Teléfono</mat-label>
            <input matInput formControlName="phone" required />
            <mat-icon matSuffix class="text-green-400">phone</mat-icon>
            <mat-error *ngIf="patientForm.get('personalInfo.phone')?.hasError('required')">El teléfono es obligatorio</mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Fecha de Nacimiento</mat-label>
            <input matInput formControlName="birthDate" type="date" required />
            <mat-icon matSuffix class="text-green-400">cake</mat-icon>
            <mat-error *ngIf="patientForm.get('personalInfo.birthDate')?.hasError('required')">La fecha de nacimiento es obligatoria</mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Género</mat-label>
            <mat-select formControlName="gender" required>
              <mat-option *ngFor="let gender of genderOptions" [value]="gender.value">
                {{ gender.label }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix class="text-green-400">wc</mat-icon>
            <mat-error *ngIf="patientForm.get('personalInfo.gender')?.hasError('required')">El género es obligatorio</mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Estado Civil</mat-label>
            <mat-select formControlName="maritalStatus">
              <mat-option *ngFor="let status of maritalStatusOptions" [value]="status.value">
                {{ status.label }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix class="text-green-400">family_restroom</mat-icon>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Ocupación</mat-label>
            <input matInput formControlName="occupation" />
            <mat-icon matSuffix class="text-green-400">work</mat-icon>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="w-full md:col-span-2 lg:col-span-3">
            <mat-label>Dirección</mat-label>
            <textarea matInput formControlName="address" rows="3"></textarea>
            <mat-icon matSuffix class="text-green-400">home</mat-icon>
          </mat-form-field>
        </div>
      </div>

      <!-- Información Médica -->
      <div class="bg-white p-8 rounded-2xl shadow-lg border border-green-100 transition-all duration-300 hover:shadow-xl backdrop-blur-sm backdrop-filter" formGroupName="medicalInfo">
        <div class="flex items-center mb-8">
          <div class="bg-gradient-to-r from-red-500 to-red-600 p-3 rounded-xl shadow-md mr-4">
            <mat-icon class="text-white">medical_services</mat-icon>
          </div>
          <div>
            <h3 class="text-xl font-semibold text-red-900">Información Médica</h3>
            <p class="text-red-600 text-sm mt-1">Historial médico y datos clínicos</p>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Tipo de Sangre</mat-label>
            <mat-select formControlName="bloodType">
              <mat-option *ngFor="let blood of bloodTypeOptions" [value]="blood.value">
                {{ blood.label }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix class="text-red-400">bloodtype</mat-icon>
          </mat-form-field>
        </div>

        <!-- Alergias -->
        <div class="mb-6">
          <div class="flex items-center justify-between mb-4">
            <h4 class="text-lg font-medium text-gray-700">Alergias</h4>
            <button type="button" mat-raised-button color="accent" (click)="addAllergy()" class="ml-4">
              <mat-icon>add</mat-icon>
              Agregar Alergia
            </button>
          </div>
          <div class="flex flex-wrap gap-2" *ngIf="patientForm.get('medicalInfo.allergies')?.value?.length > 0">
            <mat-chip-set>
              <mat-chip *ngFor="let allergy of patientForm.get('medicalInfo.allergies')?.value; let i = index" 
                       [removable]="true" (removed)="removeAllergy(i)">
                {{ allergy }}
                <mat-icon matChipRemove>cancel</mat-icon>
              </mat-chip>
            </mat-chip-set>
          </div>
          <p class="text-gray-500 text-sm mt-2" *ngIf="patientForm.get('medicalInfo.allergies')?.value?.length === 0">
            No se han registrado alergias
          </p>
        </div>

        <!-- Condiciones Crónicas -->
        <div class="mb-6">
          <div class="flex items-center justify-between mb-4">
            <h4 class="text-lg font-medium text-gray-700">Condiciones Crónicas</h4>
            <button type="button" mat-raised-button color="accent" (click)="addChronicCondition()" class="ml-4">
              <mat-icon>add</mat-icon>
              Agregar Condición
            </button>
          </div>
          <div class="flex flex-wrap gap-2" *ngIf="patientForm.get('medicalInfo.chronicConditions')?.value?.length > 0">
            <mat-chip-set>
              <mat-chip *ngFor="let condition of patientForm.get('medicalInfo.chronicConditions')?.value; let i = index" 
                       [removable]="true" (removed)="removeChronicCondition(i)">
                {{ condition }}
                <mat-icon matChipRemove>cancel</mat-icon>
              </mat-chip>
            </mat-chip-set>
          </div>
          <p class="text-gray-500 text-sm mt-2" *ngIf="patientForm.get('medicalInfo.chronicConditions')?.value?.length === 0">
            No se han registrado condiciones crónicas
          </p>
        </div>

        <!-- Contacto de Emergencia -->
        <div formGroupName="emergencyContact">
          <h4 class="text-lg font-medium text-gray-700 mb-4">Contacto de Emergencia</h4>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Nombre del Contacto</mat-label>
              <input matInput formControlName="name" required />
              <mat-icon matSuffix class="text-red-400">contact_emergency</mat-icon>
              <mat-error *ngIf="patientForm.get('medicalInfo.emergencyContact.name')?.hasError('required')">El nombre del contacto es obligatorio</mat-error>
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Relación</mat-label>
              <input matInput formControlName="relationship" required />
              <mat-icon matSuffix class="text-red-400">family_restroom</mat-icon>
              <mat-error *ngIf="patientForm.get('medicalInfo.emergencyContact.relationship')?.hasError('required')">La relación es obligatoria</mat-error>
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Teléfono de Contacto</mat-label>
              <input matInput formControlName="phone" required />
              <mat-icon matSuffix class="text-red-400">phone</mat-icon>
              <mat-error *ngIf="patientForm.get('medicalInfo.emergencyContact.phone')?.hasError('required')">El teléfono de contacto es obligatorio</mat-error>
            </mat-form-field>
          </div>
        </div>
      </div>

      <!-- Información del Seguro -->
      <div class="bg-white p-8 rounded-2xl shadow-lg border border-blue-100 transition-all duration-300 hover:shadow-xl backdrop-blur-sm backdrop-filter" formGroupName="insuranceInfo">
        <div class="flex items-center mb-8">
          <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-3 rounded-xl shadow-md mr-4">
            <mat-icon class="text-white">security</mat-icon>
          </div>
          <div>
            <h3 class="text-xl font-semibold text-blue-900">Información del Seguro</h3>
            <p class="text-blue-600 text-sm mt-1">Datos del seguro médico</p>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Proveedor de Seguro</mat-label>
            <input matInput formControlName="provider" />
            <mat-icon matSuffix class="text-blue-400">business</mat-icon>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Número de Póliza</mat-label>
            <input matInput formControlName="policyNumber" />
            <mat-icon matSuffix class="text-blue-400">confirmation_number</mat-icon>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Número de Grupo</mat-label>
            <input matInput formControlName="groupNumber" />
            <mat-icon matSuffix class="text-blue-400">group</mat-icon>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Fecha de Vencimiento</mat-label>
            <input matInput formControlName="expiryDate" type="date" />
            <mat-icon matSuffix class="text-blue-400">event</mat-icon>
          </mat-form-field>
        </div>
      </div>

      <!-- Clínica -->
      <div class="bg-white p-8 rounded-2xl shadow-lg border border-purple-100 transition-all duration-300 hover:shadow-xl backdrop-blur-sm backdrop-filter">
        <div class="flex items-center mb-8">
          <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-3 rounded-xl shadow-md mr-4">
            <mat-icon class="text-white">local_hospital</mat-icon>
          </div>
          <div>
            <h3 class="text-xl font-semibold text-purple-900">Clínica</h3>
            <p class="text-purple-600 text-sm mt-1">Seleccione la clínica</p>
          </div>
        </div>
        
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Clínica</mat-label>
          <mat-select formControlName="clinicId" required>
            <!-- Aquí deberías cargar las clínicas disponibles -->
            <mat-option value="clinic-1">Clínica Central</mat-option>
            <mat-option value="clinic-2">Clínica Norte</mat-option>
            <mat-option value="clinic-3">Clínica Sur</mat-option>
          </mat-select>
          <mat-icon matSuffix class="text-purple-400">local_hospital</mat-icon>
          <mat-error *ngIf="patientForm.get('clinicId')?.hasError('required')">La clínica es obligatoria</mat-error>
        </mat-form-field>
      </div>

      <!-- Botones de Acción -->
      <div class="flex justify-center gap-4 pt-8">
        <button type="button" mat-stroked-button color="warn" (click)="router.navigate(['/dashboard/patients/list'])" class="px-8">
          <mat-icon>cancel</mat-icon>
          Cancelar
        </button>
        <button type="submit" mat-raised-button color="primary" [disabled]="patientForm.invalid" class="px-8">
          <mat-icon>{{ isEditMode ? 'update' : 'save' }}</mat-icon>
          {{ isEditMode ? 'Actualizar' : 'Guardar' }} Paciente
        </button>
      </div>
    </form>
  </div>
</div>
